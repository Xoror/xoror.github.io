import{j as e,h as R,C as $,i as G,r as y,n as J,D as L,c as M,u as O,f as B,T as U,b as X,R as Z,A as ee,k as le,l as te,m as ne,s as se,o as ie,G as Q,a as H,F as S,M as E,I as q,p as A,q as ae,t as oe,B as ce,v as re,w as de,x as ue}from"./index-95023540.js";import{O as z}from"./OffCanvas-bd396f7b.js";const he=l=>{let t;l.data===void 0?t={name:l.name,range:l.range,type:l.type,description:l.description,school:l.school,ritual:l.ritual,classes:l.classes,components:l.components,duration:l.duration,castingTime:l.castingTime}:t=l.data;let m="";for(let o=0;o<t.classes.length;o++)o===t.classes.length-1?m+=`${t.classes[o].name}`:m+=`${t.classes[o].name}, `;let v="";for(let o=0;o<t.components.length;o++)o===t.components.length-1?v+=`${t.components[o]}`:v+=`${t.components[o]}, `;return e.jsxs("div",{className:`${l.show} spellcard`,children:[e.jsxs("h4",{children:[t.name,null]}),l.offCanvas?e.jsxs("h6",{children:[" Classes: ",m," "]}):null,e.jsxs(R,{className:"spellcard-row",children:[e.jsx($,{children:"Casting Time:"}),e.jsxs($,{md:"auto",children:[t.castingTime," ",t.ritual?" or Ritual":""]})]}),e.jsxs(R,{className:"spellcard-row",children:[e.jsx($,{children:"Range:"}),e.jsx($,{md:"auto",children:t.range})]}),e.jsxs(R,{className:"spellcard-row",children:[e.jsx($,{children:"Components:"}),e.jsx($,{md:"auto",children:v})]}),e.jsxs(R,{className:"spellcard-row",children:[e.jsx($,{children:"Duration:"}),e.jsxs($,{md:"auto",children:[t.duration[0]," ",t.duration[1]?"(Concentration)":null]})]}),e.jsx(R,{children:e.jsxs($,{className:"spellcard-section overflow",children:[t.description[0].map((o,f)=>e.jsx("p",{style:{paddingRight:"0.5em",textAlign:"justify"},children:o},`${t.name}-spellcard-description-${f}`)),e.jsxs("p",{style:{paddingRight:"0.5em",textAlign:"justify"},children:[" ",e.jsx("b",{children:"At higher levels: "})," ",t.description[1]]})]})}),e.jsx("section",{children:e.jsxs("p",{className:"spellcard-footer",children:[t.type," level ",t.school," spell"]})})]},l.id)};const me=l=>{let t;return l.data!=null?t=l.data:t={name:l.name,type:l.type,range:l.range,damage:l.damage,damageType:l.damageType,scaling:l.scaling,description:l.description,isProficient:l.isProficient},e.jsxs(G,{className:`${l.show} actioncard`,children:[e.jsx("h4",{children:t.name}),e.jsxs(R,{className:"actioncard-row",children:[e.jsx($,{children:e.jsx("span",{children:"Action Type: "})}),e.jsx($,{md:"auto",children:t.type})]}),e.jsxs(R,{className:"actioncard-row",children:[e.jsx($,{children:e.jsx("span",{children:"Range: "})}),e.jsx($,{md:"auto",children:t.range})]}),e.jsxs(R,{className:"actioncard-row",children:[e.jsx($,{children:e.jsx("span",{children:"Damage: "})}),e.jsxs($,{md:"auto",children:[t.damage," ",t.damageType!=null&&t.damageType!="None"?"("+t.damageType+")":null]})]}),e.jsxs(R,{className:"actioncard-row",children:[e.jsx($,{children:e.jsx("span",{children:"Scales with: "})}),e.jsx($,{md:"auto",children:t.scaling})]}),e.jsx(R,{children:e.jsx($,{className:"actioncard-section overflow",children:e.jsx("p",{children:t.description})})}),e.jsx("section",{children:e.jsxs("p",{className:"actioncard-footer",children:[" ",t.isProficient!=null?t.isProficient?"Is proficient.":"Is not proficient.":null]})})]},`${l.id}`)};const _=l=>{let t=l.spellBonus===void 0||l.spellBonus===""?0:l.spellBonus,m=l.singleValue===void 0?0:l.singleValue,v=l.noOptions===void 0?l.options===void 0?!0:l.options.length===1:l.noOptions,o=l.bonus===void 0||l.bonus===""?0:parseInt(l.bonus),f=l.singleValue===void 0?null:l.singleValue.toString().includes("d"),s=f!=null&&f!=null?f:!1;const h=y.useMemo(()=>{if(l.options!=null)if(l.options[0].value.includes(" + MOD")){let a=[];return l.options.forEach((d,g)=>{a.push({label:d.label,value:d.value.replace(" + MOD"," + "+t.toString())})}),a}else return l.options.length===1&&(l.options[0].value.includes("d")?(m=l.options[0].value,s=!0):m=l.options[0].value),l.options;else return l.options},[l.options,l.spellBonus]),[c,b]=y.useState(l.options===void 0?m:h[0].value),w=a=>a==="MOD"?["Spellcasting Modifier","modifier"]:a.includes("d")?[a.split("d"),"dice"]:[a,"value"],j=(a,d,g,D)=>{let p=D,V=g;if(d==="dice"){let P=a;for(let u=0;u<parseInt(P[0]);u++)V.push(1+Math.floor(Math.random()*parseInt(P[1]))),p+=V[u];return[V,p]}else if(d==="value")return V.push(parseInt(a)),p+=parseInt(a),[V,p];if(d==="modifier")return p+=" + Spellcasting Modifier",[V,p];console.log("Error: unknown type in rollFunction!")},F=a=>{a.preventDefault(),a.stopPropagation();let d=[],g=0+o;console.log(c);let[D,p]=c.split("+"),[V,P]=w(D),u=j(V,P,d,g);if(d=u[0],g=u[1],p){let[i,r]=w(p),N=j(i,r,d,g);d=N[0],g=N[1]}l.passData(a,l.name,c,d,o,g)},[T,k]=y.useState(!1),C=a=>{a.stopPropagation(),k(!T)},n=a=>{a.stopPropagation(),console.log(a.target.value),b(a.target.value)},x=l.controlID?l.controlID+"-dice-roll-button":J()+"-dice-roll-dropdown";return e.jsx(e.Fragment,{children:v?s?e.jsx("div",{style:l.dropdownStyle,className:"dice-button-solo",children:e.jsxs(M,{variant:"primary",className:"dice-button-button-solo",style:l.rollButtonStyle,onClick:F,children:[e.jsx("span",{className:"visually-hidden",children:"Roll "}),m," ",l.bonus!=""&&l.bonus!=null?"+ "+l.bonus.toString():""]})}):e.jsx("div",{style:l.noDiceValueStyle,className:"no-dice-value",children:e.jsxs("span",{children:[m," ",l.bonus!=""&&l.bonus!=null?" + "+l.bonus.toString():" "," "]})}):e.jsxs(L,{controlID:x,show:T,onToggle:C,style:l.dropdownStyle,className:"dice-dropdown",children:[e.jsxs(M,{variant:"primary",className:"dice-button-button",style:l.rollButtonStyle,onClick:F,children:[e.jsx("span",{className:"visually-hidden",children:"Roll "}),c," ",l.bonus!=""&&l.bonus!=null?"+ "+l.bonus.toString():""]}),e.jsx(L.Toggle,{variant:"primary",className:"dice-button-menu-toggle",style:l.toggleButtonStyle,children:e.jsx("span",{className:"visually-hidden",children:"Toggle dice options"})}),e.jsx(L.Menu,{variant:"dark",style:l.menuStyle,children:h.map((a,d)=>e.jsxs(L.Item,{style:l.itemStyle,id:`dice-option-value-${a.value}`,as:"button",value:a.value,onClick:n,children:[a.label,": ",a.value]},`dice-option-value-${a.value}`))})]})})},Y=l=>{const t=O(),m=B(n=>n.attributes.charAttributes),v=B(n=>n.attributes.casting.spellAttribute),o=B(n=>n.attributes.proficiency),f=B(n=>n.charDetails.charLevel),[s,h]=y.useState(""),[c,b]=y.useState([!1,"bla"]),w=n=>n==="None"||n===""?"":m.filter(x=>n===x.name)[0].bonus,j=(n,x,a)=>{n.stopPropagation(),t(ne(x,l.id))},F=n=>{n.stopPropagation();let x=n.target.id,a=n.target.checked,d=l.offCanvas;t(se(x,a,d))},T=(n,x)=>{n.stopPropagation(),l.setDefaultValues(x),l.setOldData(x),l.setEditing(!0),l.setShowQuickAddAction(!0),l.setInputFocus(),l.inputRef.current.scrollIntoView()},k=(n,x,a)=>{let d,g=[],D=1;if(x==="dmgHigherLevel"){if(n==="None")return g.push({value:a,label:"1"}),console.log(g),g;d=Object.keys(n);for(let p of d)g.push({value:n[p],label:p});return g}else if(x==="cantrip"){d=Object.keys(n),D=n[d[0]];for(let p=1;p<d.length;p++)if(f<parseInt(d[p])){D=n[d[p-1]];break}return f>=parseInt(d[d.length-1])&&(D=n[d[d.length-1]]),D}else return g},C=(n,x,a,d,g,D)=>{t(ie([x,a,d,g,D]))};return e.jsxs("div",{style:{marginLeft:"0.5em",marginRight:"0.5em"},children:[e.jsxs("h5",{children:[" ",l.header," ",l.spells?l.header==="Cantrip"?"":"Level":""," "]}),e.jsxs(U,{size:"sm",style:{color:"white",border:"black"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[l.spells?e.jsx("th",{children:l.offCanvas?"Learn":""}):null,e.jsx("th",{children:" Name "}),l.spells?null:e.jsx("th",{children:" Hit "}),l.offCanvas?null:e.jsx("th",{children:" Damage (Type) "}),l.offCanvas?e.jsx("th",{children:" School "}):e.jsx("th",{children:" Range "}),l.offCanvas?null:e.jsxs("th",{children:[" ",""," "]})]})}),e.jsx("tbody",{children:l.bodies.map((n,x)=>!l.offCanvas||xe(n,l.filters,l.searchField)?e.jsxs(X.Fragment,{children:[e.jsxs("tr",{className:"action-table",id:`${l.offCanvas}-action-table-row-id-${n.id}`,children:[l.spells?e.jsx("td",{style:{height:"1.5em",width:"1.5em",zIndex:"2"},children:e.jsx("div",{className:"checkbox-wrapper",children:e.jsx("input",{className:`${l.offCanvas?"letter-k":"letter-p"}`,type:"checkbox",id:n.name,value:"prepared",onClick:F,defaultChecked:n.isPrepared})})}):"",e.jsx("td",{children:n.name}),l.spells?"":e.jsxs("td",{children:[n.damage!="None"&&n.damage!="none"?n.isProficient?o.value+w(n.scaling):0+w(n.scaling):"-"," "]}),l.offCanvas?"":l.spells?e.jsx("td",{children:l.header!=="Cantrip"?e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[" ",n.damage!="None"?e.jsx(_,{controlID:n.name,passData:C,name:`${n.name}`,options:k(n.damageAtHigherLevel,"dmgHigherLevel",n.damage),spellBonus:w(v)}):n.damage," ",n.damageType!="None"?"("+n.damageType+")":""]}):e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[" ",n.damage!="None"?e.jsx(_,{controlID:n.name,passData:C,name:`${n.name}`,noDice:!0,noOptions:!0,singleValue:k(n.damageAtHigherLevel,"cantrip")}):n.damage,n.damageType!="None"?"("+n.damageType+")":""]})}):e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[e.jsx(_,{controlID:n.name,passData:C,name:`${n.name}`,noDice:!0,noOptions:!0,singleValue:n.damage,bonus:w(n.scaling)}),"(",n.damageType,")"]})}),l.offCanvas?e.jsx("td",{children:n.school}):e.jsx("td",{children:n.range}),l.offCanvas?"":e.jsxs("td",{style:{paddingRight:"0",paddingLeft:"0",justifyItems:"end",zIndex:"2",height:"2.25em",width:"4.5em"},children:[e.jsx("button",{className:"react-icons-button edit",onClick:a=>T(a,n),"aria-label":`edit ${l.spells?"spell":"action"}`,children:e.jsx(Z,{size:"1.5em",className:"edit-button"})}),e.jsx("button",{className:"react-icons-button delete",onClick:a=>j(a,n.id),"aria-label":`delete ${l.spells?"spell":"action"}`,children:e.jsx(ee,{size:"1.5em",className:"delete-button"})}),c[0]&&c[1]===n.id?e.jsx("button",{className:"react-icons-button",onClick:a=>b([!1,"bla"]),"aria-label":`expand ${l.spells?"spell":"action"} details`,children:e.jsx(le,{size:"1.5em",className:"expand-button"})}):e.jsx("button",{className:"react-icons-button",onClick:a=>b([!0,n.id]),"aria-label":`expand ${l.spells?"spell":"action"} details`,children:e.jsx(te,{size:"1.5em",className:"expand-button"})})]})]}),c[0]&&c[1]===n.id?e.jsx("tr",{children:l.spells?e.jsx("td",{style:{borderRight:"1px solid rgba(1,1,1,0.5)",borderLeft:"1px solid rgba(1,1,1,0.5)"},colSpan:5,children:e.jsx(he,{id:`spellcard-${s.id}`,offCanvas:l.offCanvas,data:s})}):e.jsx("td",{style:{borderRight:"1px solid rgba(1,1,1,0.5)",borderLeft:"1px solid rgba(1,1,1,0.5)"},colSpan:5,children:e.jsx(me,{id:`actioncard-${s.id}`,data:s})})},`spell-details-id-${n.id}`):null]},`${l.offCanvas}-action-table-row-id-${n.id}`):null)})]})]},l.index)},xe=(l,t,m)=>{let v=m===""?!0:l.name.toLowerCase().includes(m.toLowerCase()),o=t.spellslots.length===0?!0:!!t.spellslots.find(c=>c===l.type),f=t.schools.length===0?!0:!!t.schools.find(c=>c===l.school),s=!1;if(t.classes.length!=0)for(let c of t.classes)for(let b of l.classes)c===b.name&&(s=!0);else s=!0;let h=!1;if(t.ritual.length!=0){if(t.ritual.length==1){let c;l.ritual?c="ritual":c="not ritual",h=!!t.ritual.find(b=>b===c)}}else h=!0;return v&&o&&f&&s&&h};function ge(l){return Q({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"}}]})(l)}function fe(l){return Q({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zM8 4c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995A.905.905 0 0 1 8 4zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"}}]})(l)}const je=({children:l,className:t,show:m,variant:v="danger",...o})=>{let f="sg-form-validation-info-box"+(t?" "+t:"")+(" "+v),s={border:"0",clip:"rect(0 0 0 0)",height:"auto",margin:"0",padding:"0",position:"absolute",width:"1px",overflow:"hidden",whiteSpace:"nowrap"};return e.jsx("div",{className:f,...o,style:m?null:s,children:v==="success"?e.jsxs("h6",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ge,{size:"1.5em",color:"#198754"}),e.jsx("span",{style:{marginLeft:"0.5em"},children:"All form input values are valid!"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h6",{style:{display:"flex",alignItems:"center"},children:[e.jsx(fe,{size:"1.5em",color:"#dc3545"}),e.jsx("span",{style:{marginLeft:"0.5em"},children:"Some form input values are invalid:"})]}),l]})})},W=({modal:l,ariaLabel:t,inputRef:m,setInputFocus:v,...o})=>{const f=o.editing===void 0?!1:o.editing,s=o.defaultValues,h=o.setDefaultValues,c=o.spells===void 0?!1:o.spells,b=o.actionTemplate,w=o.handleSubmit,j=o.handleFormValueChange,F=o.options,T=["Strength","Dexterity","Constitution","Intelligence","Wisdom","Charisma","None"],k=["Abjuration","Conjuration","Divination","Enchantment","Evocation","Illusion","Necromancy","Transmutation"],C=["Bludgeoning","Slashing","Piercing","Heal","Cold","Lightning","Thunder","Acid","Poison","Necrotic","Radiant","Psychic","Force","Special","None"],n=[["V"],["S"],["M"],["V","S"],["V","M"],["S","M"],["V","S","M"]],x=m,[a,d]=H(),[g,D]=y.useState({name:!0,damage:!0,both:!0}),p=i=>{let r;if(i.includes("d")){let N=i.split("d"),I=isNaN(parseInt(N[0])),K=isNaN(parseInt(N[1]));r=!I&&!K}else r=!isNaN(parseInt(i));return r},V=i=>{if(i==="none"||i==="None"||i==="")return!0;if(i.includes("d")){let r=i.split("+"),N=p(r[0]),I=!0;return r[2]!=null&&(I=p(r[1])),r=N&&I,r}else return!isNaN(parseInt(i))},P=i=>{let r=o.actionNames.find(I=>I.name===i)===void 0;return o.spellNames.find(I=>I.name===i)===void 0&&r};y.useEffect(()=>{c?s.duration===void 0&&h(b):s.isProficient===void 0&&h(b)},[s,h,b]);const u=i=>{i.preventDefault();let r=V(i.target[2].value),N=P(i.target[0].value);if(D(I=>({...I,both:r&&N,damage:r,name:N})),r&&N){w(i);return}r||d(),N||v()};return e.jsxs(S,{id:"action-add-form","aria-label":`${f?"edit":"add-new"}-${t}-form`,onSubmit:u,children:[e.jsxs(E.Body,{children:[e.jsxs(je,{variant:g.both?"success":"danger",children:[g.name?null:e.jsx("p",{children:"Please enter unique Name."}),g.damage?null:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Damage must have form of either:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[" ","<number>d<number>, e.g 2d8, 1d20"," "]}),e.jsxs("li",{children:[" ","A single integer, e.g 20 or 4"," "]}),e.jsx("li",{children:"A combination of the two, joing by a , e.g 1d4 + 1, 2d4 + 2d8, 20 + 5d10"}),e.jsx("li",{children:'"None" or "none" if the action/spell has no damage component'})]})]})]}),e.jsxs(q,{children:[e.jsx(A,{ref:x,controlId:`${t}-name-${l?"modal":"quick"}`,label:"Name",children:e.jsx(S.Control,{required:!0,value:s.name,className:`${l?"top":"middle"}-left-group`,placeholder:"",onChange:i=>j(i,"name")})}),e.jsx(A,{controlId:`${t}-range-${l?"modal":"quick"}`,label:"Range",children:e.jsx(S.Control,{required:!0,value:s.range,placeholder:"",onChange:i=>j(i,"range")})}),e.jsx(A,{ref:a,controlId:`${t}-damage-${l?"modal":"quick"}`,label:"Damage",children:e.jsx(S.Control,{required:!0,value:s.damage,className:`${l?"top":"middle"}-right-group`,placeholder:"",onChange:i=>j(i,"damage")})})]}),e.jsxs(q,{children:[e.jsx(A,{controlId:`${t}-${c?"tier":"type"}-${l?"modal":"quick"}`,label:`${c?"Tier":"Type"}`,children:e.jsxs(S.Select,{required:!0,value:s.type,className:"middle-left-group",onChange:i=>j(i,"type"),children:[c?e.jsx("option",{value:"",children:"Choose Spell Tier"},"0"):e.jsx("option",{value:"",children:"Choose Action Type"},"0"),F.map((i,r)=>e.jsx("option",{value:i,children:i},`action-type-${i}`))]})}),e.jsx(A,{controlId:`${t}-scaling-attribute-${l?"modal":"quick"}`,label:"Scaling Attribute",children:e.jsxs(S.Select,{required:!0,value:s.scaling,className:"middle-right-group",onChange:i=>j(i,"scaling"),children:[e.jsx("option",{value:"",children:"Choose Scaling Attribute"}),T.map((i,r)=>e.jsx("option",{value:i,children:i},`scaling-attribute-${i}`))]})})]}),c&&s.duration!=null?e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsx(A,{controlId:`${t}-school-${l?"modal":"quick"}`,label:"School",children:e.jsxs(S.Select,{required:!0,value:s.school,className:"middle-left-group",onChange:i=>j(i,"school"),children:[e.jsx("option",{value:"",children:"Choose school"}),k.map((i,r)=>e.jsx("option",{value:i,children:i},`spell-shool-${i}`))]})}),e.jsx(A,{controlId:`${t}-is-ritual-${l?"modal":"quick"}`,label:"Is Ritual?",children:e.jsxs(S.Select,{required:!0,value:s.ritual,className:"middle-right-group",type:"boolean",onChange:i=>j(i,"ritual"),children:[e.jsx("option",{value:"",children:" Choose is ritual "}),e.jsx("option",{value:!0,children:"Yes"}),e.jsx("option",{value:!1,children:"No"})]})})]}),e.jsxs(q,{children:[e.jsx(A,{controlId:`${t}-casting-time-${l?"modal":"quick"}`,label:"Casting time",children:e.jsx(S.Control,{required:!0,type:"text",value:s.castingTime,className:"middle-left-group",placeholder:"",onChange:i=>j(i,"castingTime")})}),e.jsx(A,{controlId:`${t}-duration-${l?"modal":"quick"}`,label:"Duration",children:e.jsx(S.Control,{required:!0,type:"text",value:s.duration[0],placeholder:"",onChange:i=>j(i,"duration_0")})}),e.jsx(A,{controlId:`${t}-concentration-${l?"modal":"quick"}`,label:"Concentration?",children:e.jsxs(S.Select,{required:!0,value:s.duration[1],className:"middle-right-group",type:"boolean",onChange:i=>j(i,"duration_1"),children:[e.jsx("option",{value:"",children:" Requires concentration? "}),e.jsx("option",{value:!0,children:"Yes"}),e.jsx("option",{value:!1,children:"No"})]})})]})]}):null,e.jsxs(q,{children:[c&&s.duration!=null?e.jsx(A,{controlId:`${t}-components-${l?"modal":"quick"}`,label:"Components",children:e.jsxs(S.Select,{required:!0,value:s.components,className:"middle-left-group",type:"text",onChange:i=>j(i,"components"),children:[e.jsx("option",{value:"",children:"Choose components"}),n.map((i,r)=>e.jsx("option",{value:i,children:i},`component-choice-${i}`))]})}):e.jsx(A,{controlId:`${t}-is-proficient-${l?"modal":"quick"}`,label:"Is Proficient?",children:e.jsxs(S.Select,{required:!0,value:s.isProficient,className:"middle-left-group",type:"boolean",onChange:i=>j(i,"isProficient"),children:[e.jsx("option",{value:"",children:"Choose if proficient"}),e.jsx("option",{value:!0,children:"Yes"}),e.jsx("option",{value:!1,children:"No"})]})}),e.jsx(A,{controlId:`${t}-damage-type-${l?"modal":"quick"}`,label:"Damage Type",children:e.jsxs(S.Select,{required:!0,value:s.damageType,className:"middle-right-group",onChange:i=>j(i,"damageType"),children:[e.jsx("option",{value:"",children:"Choose Damage Type"}),C.map((i,r)=>e.jsx("option",{value:i,children:i},`damage-type-${i}`))]})}),l?null:e.jsx(M,{variant:"success",className:"middle-right-group",type:"submit",children:"Submit"})]}),e.jsx(A,{controlId:`${t}-description-${l?"modal":"quick"}`,label:"Description",children:e.jsx(S.Control,{as:"textarea",className:c&&s.duration!=null?"middle-left-group middle-right-group":"bottom-left-group bottom-right-group",style:{height:"8em"},placeholder:"",value:s.description[0],onChange:i=>j(i,"description_0")})}),c&&s.duration!=null?e.jsx(A,{controlId:`${t}-description-at-higher-level-${l?"modal":"quick"}`,label:"At higher level",children:e.jsx(S.Control,{as:"textarea",className:"bottom-left-group bottom-right-group",style:{height:"8em"},placeholder:"",value:s.description[1],onChange:i=>j(i,"description_1")})}):null]}),l?e.jsxs(E.Footer,{children:[e.jsx(M,{variant:"danger",type:"button",onClick:()=>o.setShowAddAction(!1),children:"Close"}),e.jsx(M,{variant:"primary",type:"submit",children:"Save Changes"})]}):null]})},ve=l=>{const t=l.editing===void 0?!1:l.editing,m=l.setEditing,v=l.defaultValues,o=l.setDefaultValues;let f=l.spells===void 0?!1:l.spells;const s=l.actionTemplate;let h=f?"spell":"action";const c=b=>{m(!1),o(s)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{"aria-labelledby":`${t?"edit":"add-new"}-${h}`,className:l.showQuickAddAction?null:"visually-hidden",children:[e.jsxs(q,{children:[e.jsxs(q.Text,{as:"label",id:`${t?"edit":"add-new"}-${h}`,className:"top-left-group top-right-group",style:{flexGrow:"2"},children:[" ",t?"Currently editing: "+v.name:f?"Add New Spell":"Add New Action/Bonus Action/etc:"," "]}),t?e.jsx(M,{onClick:c,children:"Cancel"}):""]}),e.jsx(W,{modal:!1,ariaLabel:h,inputRef:l.inputRef,setInputFocus:l.setInputFocus,...l})]}),e.jsxs(E,{backdrop:"static","aria-labelledby":`add-new-${h}-dialog`,size:"lg",show:l.showAddAction,onHide:()=>l.setShowAddAction(!1),children:[e.jsx(E.Header,{closeButton:!0,children:e.jsxs(E.Title,{as:"label",id:`add-new-${h}-dialog`,children:["Adding a new ",f?"Spell":"Action"]})}),e.jsx(W,{modal:!0,ariaLabel:h,inputRef:l.inputModalRef,setInputFocus:l.setInputModalFocus,...l})]})]})},pe=l=>{O();const t=l.inheritShow,m=l.setInheritShow,v=B(C=>C.actions.sortedSpellList),[o,f]=y.useState(!1),[s,h]=y.useState({spellslots:[],schools:[],ritual:[],classes:[]}),[c,b]=y.useState(""),w=()=>{f(!1),h({spellslots:[],schools:[],ritual:[],classes:[]}),m(!t)},j=()=>{f(!0)};y.useEffect(()=>{t&&j()},[t]);const F=Object.keys(s),T=(C,n,x)=>{let a=structuredClone(s);a[x]=a[x].slice(0,n).concat(a[x].slice(n+1)),h(a)};let k=["Cantrip","1st","2nd","3rd","4th","5th","6th","7th","8th","9th"];return e.jsxs(z,{show:o,onHide:w,placement:"start",children:[e.jsx(z.Header,{closeButton:!0,onClick:w,children:e.jsx(z.Title,{children:"Spell List"})}),e.jsxs(z.Body,{children:[e.jsx(Se,{filters:s,searchField:c,setFilters:h,setSearchField:b}),e.jsxs(ae,{fluid:!0,className:"filter-container",children:[e.jsx("span",{children:"Filters: "}),F.map(C=>s[C].map((n,x)=>e.jsx(Ce,{index:x,type:C,name:n,handleDelete:T},`filter-item-${n}`)))]}),k.map((C,n)=>e.jsx(Y,{offCanvas:!0,id:l.id,header:C,searchField:c,filters:s,bodies:v.filter(x=>x.type===C),spells:"true"},`action-table-${C}`))]})]})},Ce=l=>e.jsxs("div",{className:"filter-body",children:[l.name," ",e.jsx(oe,{type:"button",color:"black",size:"20",id:"delete-button","aria-label":"delete filter item "+l.name,onClick:t=>l.handleDelete(t,l.index,l.type),className:"filter-delete-button"})]}),Se=l=>{O();let t="";const m=(s,h)=>{h==="search"?l.setSearchField(s.target.value):t=s.target.value;let c=structuredClone(l.filters);h!="search"?(c[h].push(s.target.value),l.setFilters(c)):h==="search"&&s.target.value},v=["Cantrip","1st","2nd","3rd","4th","5th","6th","7th","8th","9th"],o=["Bard","Cleric","Druid","Paladin","Ranger","Sorcerer","Warlock","Wizard"],f=["Abjuration","Conjuration","Divination","Enchantment","Evocation","Illusion","Necromancy","Transmutation"];return e.jsxs(e.Fragment,{children:[e.jsx(S.Control,{placeholder:"Search",type:"search",onChange:s=>m(s,"search")}),e.jsxs(q,{children:[e.jsxs(S.Select,{value:t,"aria-label":"Choose spell school",onChange:s=>m(s,"schools"),children:[e.jsx("option",{value:"",children:"Filter schools"}),f.map((s,h)=>l.filters.schools.filter(c=>c===s).length===0?e.jsx("option",{value:s,children:s},`filter-option-school-${s}`):"")]}),e.jsxs(S.Select,{value:t,"aria-label":"Choose class",onChange:s=>m(s,"classes"),children:[e.jsx("option",{value:"",children:"Filter classes"}),o.map((s,h)=>l.filters.classes.filter(c=>c===s).length===0?e.jsx("option",{value:s,children:s},`filter-option-class-${s}`):"")]})]}),e.jsxs(q,{children:[e.jsxs(S.Select,{value:t,"aria-label":"Choose spell slot",onChange:s=>m(s,"spellslots"),children:[e.jsx("option",{value:"",children:"Filter spell tier"}),v.map((s,h)=>l.filters.spellslots.filter(c=>c===s).length===0?e.jsx("option",{value:s,children:s},`filter-option-level-${s}`):"")]}),e.jsxs(S.Select,{value:t,"aria-label":"Is spell Ritual",onChange:s=>m(s,"ritual"),children:[e.jsx("option",{value:"",children:" Is spell ritual? "}),l.filters.ritual.filter(s=>s==="ritual").length===0?e.jsx("option",{value:"ritual",children:" Is ritual spell "}):"",l.filters.ritual.filter(s=>s==="not ritual").length===0?e.jsx("option",{value:"not ritual",children:" Is not ritual spell"}):""]})]})]})},$e=l=>{const t=O();let m=l.id==="Spells"?{showCard:!1,filtered:!0,id:"",name:"",range:"",damage:"",damageAtHigherLevel:"None",type:"",scaling:"",isPrepared:!1,damageType:"",description:[[""],""],school:"",ritual:"",classes:"",components:"",duration:["",""],castingTime:""}:{id:"",name:"",range:"",damage:"",type:"",scaling:"",isProficient:"",damageType:"",description:""};const v=B(u=>u.actions.actions),o=B(u=>u.actions.sortedSpellList),f=v.map(u=>u.name),s=o.map(u=>u.name),[h,c]=y.useState(!1),[b,w]=y.useState(!1),[j,F]=y.useState(!1),[T,k]=y.useState(m),[C,n]=y.useState({}),[x,a]=y.useState(!1),[d,g]=H(),[D,p]=H(),V=(u,i)=>{u.preventDefault();let r=T,N=!1;x?(re.isEqual(r,C)||(r.id=C.id,t(de(r,l.id,C.name))),a(!1)):v.filter(I=>I.name===u.target[0].value).length!=0||o.filter(I=>I.name===u.target[0].value).length!=0?(u.stopPropagation(),i?p():g(),N=!0):t(ue(r,l.id)),N||(k(m),w(!1))},P=(u,i)=>{let r=structuredClone(T);if(i==="description_0"){let N=u.target.value.split(`
`).filter(I=>I!="");r.description=[N,r.description[1]]}else i==="description_1"?r.description=[r.description[0],u.target.value]:i==="duration_0"?r.duration=[u.target.value,r.duration[1]]:i==="duration_1"?r.duration=[r.duration[0],u.target.value]:u.target!=null&&(r[i]=u.target.value);k(r)};return e.jsxs(G,{className:"main-element-sub-card",id:"ActionsPart",children:[l.headers.map((u,i)=>e.jsx(Y,{setOldData:n,setEditing:a,setShowQuickAddAction:F,setDefaultValues:k,offCanvas:l.offCanvas,id:l.id,header:u,bodies:l.actions.filter(r=>r.type===u),spells:l.spells,inputRef:d,setInputFocus:g},`actions-table-${u}`)),e.jsxs(ce,{children:[e.jsxs(M,{onClick:u=>w(!b),children:["Add ",l.id==="Spells"?"Spell":"Action"]}),e.jsxs(M,{onClick:u=>F(!j),children:["Quick Add ",l.id==="Spells"?"Spell":"Action"]}),l.id==="Spells"?e.jsx(M,{onClick:u=>c(!h),children:"Browse Spell List"}):null]}),l.id==="Spells"?e.jsx(pe,{inheritShow:h,setInheritShow:c}):null,e.jsx(ve,{editing:x,setEditing:a,defaultValues:T,setDefaultValues:k,inputRef:d,setInputFocus:g,inputModalRef:D,setInputModalFocus:p,actionNames:f,spellNames:s,spells:l.spells,actionTemplate:m,handleSubmit:V,handleFormValueChange:P,options:l.options,showAddAction:b,setShowAddAction:w,showQuickAddAction:j,setShowQuickAddAction:F})]})};export{$e as default};
